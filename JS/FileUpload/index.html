<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fileUpload</title>
    <script src="ajax.js"></script>
</head>
<body>
    <!--在files的原型的原型上有一个Blob中的slice方法可以实现文件的切片处理-->
    <input type="file" id="fileUpload" accept="image/*">
    <br>
    <img src="" alt="" id="serverImg">
    <script>
        let limitType = ['image/jpeg','image/jpg','image/png','image/gif']
        let limitMax = 100 * 1024
        fileUpload.onchange = async function() {
            let file = fileUpload.files[0]
            if(!file) return
            if(!limitType.includes(file.type)) {
                alert('图片必须是jpeg、jpg、png、gif格式')
                fileUpload.value = ''
                return
            }
            if(file.size > limitMax) {
                alert('只能上传100kb以内文件')
                return
            }
            let formData = new FormData()
            formData.append('chunk',file)
            //拼成一个hash+文件名的名字上传
            formData.append('filename',$formatFileName(file.name).filename)
            let result = await $ajax({
                url:'http://127.0.0.1:3005/single',
                
                data:formData
            })
            if(result.code == 0) {
                serverImg.src = result.path
            }
        }
    </script>
</body>
</html>